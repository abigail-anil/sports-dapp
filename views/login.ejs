<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | Sports DApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="height: 100vh;">
  <div class="card shadow-lg p-4" style="width: 100%; max-width: 420px;">
    <h3 class="text-center mb-4">🏅 Sports DApp Login</h3>

    <div class="text-center">
      <button id="connectBtn" class="btn btn-primary w-100" onclick="loginWithMetaMask()">🔗 Login with MetaMask</button>
      <p id="loginStatus" class="text-success mt-3"></p>
    </div>
  </div>

  <script>
    async function loginWithMetaMask() {
      if (!window.ethereum) return alert("MetaMask not detected. Please install it.");
  
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
  
        // Handle user rejection
        await provider.send("eth_requestAccounts", []).catch(() => {
          alert("🔒 Connection request was rejected.");
          return;
        });
  
        const signer = provider.getSigner();
        const address = await signer.getAddress();
  
        // Store login state
        localStorage.setItem("walletConnected", "true");
        localStorage.setItem("userAddress", address);
  
        document.getElementById("loginStatus").innerText = `✅ Logged in as: ${address}`;
  
        // ⏩ Better redirect using replace()
        setTimeout(() => {
          window.location.replace("/dashboard"); // instead of href
        }, 1000);
  
      } catch (err) {
        console.error("Login failed:", err);
        alert("❌ Login failed. Please try again.");
      }
    }
  </script>
  
</body>
</html>
